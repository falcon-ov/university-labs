# Лабораторная работа №4: Анализ и расширенная визуализация данных в Zabbix
#### Цель работы
Ознакомление студентов с расширенными возможностями платформы Zabbix: создание
графиков и отчётов, использование сложных элементов (item), корреляция метрик и
оптимизация системы мониторинга.
### Задачи
1. Использовать зависимые (dependent) и вычисляемые (calculated) элементы данных.
2. Настраивать шаблоны (templates) для групп хостов.
3. Создавать пользовательские графики и автоматические отчёты.
4. Интерпретировать и сопоставлять собранные данные (например, CPU + память + сеть).
5. Настраивать условные оповещения по нескольким критериям.
6. Оптимизировать параметры сбора данных и уведомлений.
### Необходимые ресурсы
    - Рабочий сервер Zabbix (установленный на предыдущей лабораторной работе).
    - Как минимум один хост с активным Zabbix Agent.
    - Доступ к веб-интерфейсу Zabbix с правами администратора.
## Практическая часть
0. Два инстанса готовы с прошлой лабы и запущены на Google Cloud
   Подключился к ним через Google Shell Editor с помощью команд:
    ```bash
    gcloud compute ssh instance-lab --zone=europe-north2-b -- -L 8080:localhost:80
    ```
    ```bash
    gcloud compute ssh instance-lab-small --zone=europe-north2-b -- -L 8080:localhost:80
    ```
    ![img](/images/img_1.png)
    ![img](/images/img_2.png)

    В окне подключенное к instance-lab(не агент) захожу в Web Preview, попадаю на стартавую страницу Debian, в адрессной строке дописываю `/zabbix` и попадаю в zabbix.

    ![img](/images/img_3.png)


1. Создание собственного шаблона
    - Создайте шаблон Template IT-System-Monitoring.
    (Data collection → Templates → Create template)

    ![img](/images/img_4.png)

    После нашел в списке созданный Template и...
    - Добавьте в него элементы данных (items):
    - CPU Load (avg1, avg5, avg15)
    - RAM Used %
    - Disk Space Used %
    - Network Traffic (in/out) - ens4

    ![img](/images/img_5.png)
    ![img](/images/img_6.png)
    ![img](/images/img_7.png)
    ![img](/images/img_8.png)

    ![img](/images/img_9.png)

    - Добавьте триггер:
    «High load» → если system.cpu.load[all,avg1] > 2 более 5 минут.

    ![img](/images/img_10.png)

2. Применение шаблона к хосту
    - Привяжите созданный шаблон к существующему хосту.
    - Убедитесь, что элементы и триггеры активны и собирают данные.

    Перешел в -> Hosts. Выберал хост, на котором установлен Zabbix Agent (instance-lab-small).

    В Templates нажми Link new template, выбери Template IT-System-Monitoring.
    Сохрани изменения.

    ![img](/images/img_11.png)
    ![img](/images/img_12.png)

    Получил ошибку, поэтому unlink-нул привязанный ранее template

    Подтвердил, что новые Items и триггер собирают данные (можно через Latest data).

    ![img](/images/img_13.png)
    ![img](/images/img_14.png)

3. Зависимые и вычисляемые элементы
    - Создайте calculated item, который показывает отношение «RAM Used % / CPU Load avg5».

    ![img](/images/img_15.png)

    - Создайте dependent item, который извлекает только числовые значения из текстового элемента (например, uptime).

    ![img](/images/img_16.png)

    ![img](/images/img_17.png)

    ![img](/images/img_18.png)

    ![img](/images/img_19.png)

    ![img](/images/img_20.png)

1. Визуализация и дашборды
    - Создайте график, отображающий совместную динамику CPU и RAM.

    ![img](/images/img_21.png)

    - Создайте Dashboard с виджетами:

    ![img](/images/img_22.png)

    - График, созданный ранее.

    ![img](/images/img_23.png)
    ![img](/images/img_24.png)

    - Top 5 процессов (если доступны данные).
    - Сводка по тревогам (alert summary).
    ![img](/images/img_25.png)
    ![img](/images/img_26.png)

2. Условные оповещения и действия
    - Настройте действие, которое отправляет уведомление только если:
    - CPU Load > 2 и RAM Used > 80%.
    - Используйте логические выражения (AND, OR) в настройках триггера.
    ![img](/images/img_27.png)
3. Экспорт и документирование
    - Экспортируйте шаблон в формате XML.
    ![img](/images/img_28.png)
    - Сделайте снимок экрана итогового дашборда.
    ![img](/images/img_29.png)
    - Сохраните журнал событий (тревоги, действия).
    ![img](/images/img_30.png)
    ![img](/images/img_31.png)

## Контрольные вопросы
1. В чём разница между элементами dependent и calculated?

    Dependent item получает данные из другого item'а и не делает собственный запрос. Это снижает нагрузку на систему.
    Calculated item ничего не опрашивает, а считает значение по формуле, используя другие метрики.

2. Как можно сопоставлять значения нескольких метрик на одном графике?
   
    В одном графике можно отобразить несколько item'ов, если в настройках графика добавить несколько метрик. Каждая метрика становится отдельной линией.

3. Почему стоит использовать шаблоны вместо ручной настройки хостов?

    Шаблоны позволяют быстро применять наборы метрик к множеству хостов, упрощают поддержку, уменьшают ошибки и обеспечивают единообразие настроек.

4. Как влияет интервал обновления данных (update interval) на производительность
системы?

    Чем меньше интервал обновления, тем выше нагрузка на Zabbix Server, БД и агенты. Чем больше интервал, тем ниже нагрузка, но данные обновляются реже.