# Лабораторная работа №4. Облачное хранилище данных. Amazon S3

## Цель работы

Целью работы является познакомиться с сервисом Amazon S3 (Simple Storage Service) и отработать основные операции:

- создание публичного и приватного бакетов;
- загрузку и организацию объектов;
- работу с S3 через AWS CLI (копирование, перемещение, синхронизация);
- настройку версионирования и шифрования;
- использование S3 Static Website Hosting;
- применение Lifecycle-правил для архивирования старых данных.

После выполнения работы студент:

- понимает концепцию объектного хранилища и его отличия от блочного и файлового;
- умеет создавать и настраивать бакеты в Amazon S3;
- владеет навыками загрузки и управления объектами через консоль и CLI;
- знает, как настроить статический веб-хостинг на базе S3;
- понимает принципы версионирования и жизненного цикла объектов в S3.

## Условие

_Amazon S3_ — это объектное хранилище AWS, предназначенное для хранения файлов любого типа: изображений, резервных копий, документов, логов и т.д. Каждый объект хранится внутри _бакета_ (bucket) и имеет _уникальный ключ_ (key). "Папки" в консоли — это лишь префиксы ключей, а не настоящие директории.

В этой лабораторной вы создадите два бакета:

- _Публичный бакет_ - для хранения аватаров пользователей и статического контента;
- _Приватный бакет_ - для логов и служебных файлов (с Lifecycle-политикой).

### Шаг 1. Подготовка

1. Регион: `eu-central-1` (Frankfurt).
2. Формат имён бакетов:
   1. _Публичный_: `cc-lab4-pub-kXX` - `cc-lab4-pub-k19`
   2. _Приватный_: `cc-lab4-priv-kXX` - `cc-lab4-priv-k19`
   **Мой порядковый номер XX = 19**
3. Локально (на своем компьютере) я создал структуру каталогов и файлов, как показано ниже:

   ```
   s3-lab/
    ├── public/
    │   ├── avatars/
    │   │   ├── user1.jpg
    │   │   └── user2.jpg
    │   └── content/logo.png
    ├── private/
    │   └── logs/
    │       └── activity.csv
    └── README.md
   ```

   > Данные файлы в дальнейшем были загружены в соответствующие бакеты.

### Шаг 2. Создание бакетов

На данном шаге студент может выбрать один из способов создания бакетов:

- использовать ACL (упрощённый, наглядный),
- использовать Object Ownership Enforced (современный, безопасный).
  - [Ссылка на данный вариант](./advanced.md)

> Чем отличаются два способа управления доступом к бакетам в S3?

> ACL (Access Control List) — старый способ управления доступом, где права назначаются на уровне отдельных объектов или бакета вручную.
Object Ownership (Enforced) — современный вариант, где все объекты принадлежат владельцу бакета, а доступ управляется только через IAM-политики и Bucket Policy, что безопаснее и исключает конфликт прав между пользователями.

В данном гайде описан первый способ (с использованием ACL).

Я перешёл в консоль управления AWS S3 и создал два бакета с указанными именами.

_Публичный бакет_:

1. Имя: `cc-lab4-pub-k19`
2. Region: `eu-central-1`
3. Object Ownership: ACLs enabled (Can be configured using ACLs)
4. _Block all public access_: снял галочку (разрешил публичность)
5. Подтвердил предупреждение
6. Нажал `Create bucket`

![img](/images/img_1.png)
![img](/images/img_2.png)

> Что означает опция "Block all public access" и зачем нужна данная настройка?

> Это защитный механизм AWS, который блокирует любые попытки сделать бакет или объекты в нем публично доступными. Даже если вы случайно установите публичные ACL или политики, эта настройка заблокирует публичный доступ. Это предотвращает случайную утечку данных.

Аналогично я создал _Приватный бакет_ с именем `cc-lab4-priv-k19`, но оставил все настройки по умолчанию (_Block all public access — включен_).

![img](/images/img_3.png)

> Режим ACLs enabled позволяет управлять доступом к каждому объекту отдельно (например, сделать одну картинку публичной, а другую — приватной). Это удобно для лабораторных экспериментов и визуально понятно студентам.

### Шаг 3. Загрузка объектов через AWS Management Console

1. Я перешёл в бакет `cc-lab4-pub-k19`.
2. Перешёл в директорию `avatars/` и нажал `Upload`.
3. Загрузил файл `user1.jpg` из локальной папки `s3-lab/public/avatars/`.
4. После загрузки в пункте `Permissions` выбрал `Grant public-read access`.
5. Завершил загрузку нажав `Upload`.

![img](/images/img_4.png)

> Чем отличается ключ (object key) от имени файла?

> Имя файла - это просто название файла на вашем компьютере, например: user1.jpg
Ключ объекта (Object Key) - это полный путь к объекту внутри бакета, включая все "папки" (префиксы), например: avatars/user1.jpg

### Шаг 4. Загрузка объектов через AWS CLI

1. Я установил и настроил AWS CLI.
![img](/images/img_5.png)
2. Выполнил команду для загрузки файла `user2.jpg` в публичный бакет:

   ```bash
   aws s3 cp s3-lab/public/avatars/user2.jpg s3://cc-lab4-pub-kXX/avatars/user2.jpg --acl public-read
   ```
   ![img](/images/img_6.png)

3. Загрузил файл `logo.png` в публичный бакет, в директорию `content/`, также сделав его публичным.
![img](/images/img_7.png)

4. Загрузил файл `activity.csv` в приватный бакет, не делая его публичным.

![img](/images/img_8.png)

> В чём разница между командами aws s3 `cp`, `mv` и `sync` и для чего используется параметр флаг `--acl public-read`?

| Команда | Что делает | Источник после операции | Когда использовать |
|---------|------------|------------------------|-------------------|
| `cp` | Копирует файл/папку | Остается на месте | Разовое копирование файлов |
| `mv` | Перемещает файл/папку | Удаляется | Переименование, реорганизация |
| `sync` | Синхронизирует директории | Остается на месте | Регулярное обновление, бэкапы, деплой сайтов |

**Флаг `--acl public-read`:**
- ACL (Access Control List) — список контроля доступа
- `public-read` - делает объект публично доступным для чтения всем пользователям в интернете
- Владелец сохраняет полный контроль над объектом
- Используется для публичного контента: изображений, документов, статических файлов веб-сайтов



### Шаг 5. Проверка доступа к объектам

1. Я открыл в браузере URL загруженного публичного объекта:

   ```
   https://cc-lab4-pub-kXX.s3.eu-central-1.amazonaws.com/avatars/user1.jpg
   ```

   Я увидел изображение.
   ![img](/images/img_9.png)

2. Попробовал открыть URL загруженного приватного объекта, он был недоступен.

    ![img](/images/img_10.png)

### Шаг 6. Версионирование объектов

Я включил версионирование для обоих бакетов через вкладку `Properties` → `Bucket Versioning` → `Enable`.
![img](/images/img_11.png)

1. Изменил файл `logo.png` и загрузил его заново, чтобы увидеть создание новой версии.
2. Посмотрел вкладку `Versions`, там отображались все версии объекта.

![img](/images/img_12.png)

> Что произойдёт, если выключить версионирование после его включения?

> После включения версионирование нельзя полностью отключить - его можно только приостановить (Suspended). При приостановке:
**Все существующие версии сохраняются** - старые версии объектов не удаляются и продолжают занимать место
**Новые загрузки не создают версии** - при перезаписи файла старая версия не сохраняется, файл просто перезаписывается
**Новые объекты получают Version ID = null** вместо уникального идентификатора
**Старые версии остаются доступны** по их Version ID и продолжают тарифицироваться

### Шаг 7. Создание Lifecycle-правил для приватного бакета

1. В приватном бакете я зашёл в `Management` → `Lifecycle rules` → `Create rule`.
   1. Имя: `logs-archive`
   2. Префикс: `logs/`
   3. Actions:
      1. `Transition → Standard-IA` через 30 дней
      2. `Transition → Glacier Deep Archive` через 365 дней
      3. `Expiration → удалить` через 1825 дней (5 лет)
2. Сохранил правило: `Create rule`.

![img](/images/img_13.png)

> Что такое Storage Class в Amazon S3 и зачем они нужны?

> Storage Class (класс хранения) - это категория хранения данных в S3 с разной стоимостью и скоростью доступа. Основные классы: S3 Standard (дорогой, мгновенный доступ), S3 Standard-IA (дешевле, для редко используемых данных), S3 Glacier (очень дешевый, для архивов с доступом в минуты-часы) и S3 Glacier Deep Archive (самый дешевый, доступ через 12 часов). Они нужны для экономии денег - часто используемые данные хранятся в дорогом классе с быстрым доступом, а старые архивы автоматически переносятся в дешевые классы через Lifecycle-правила. Это позволяет платить меньше за хранение данных, которые редко нужны, но должны сохраняться для соответствия требованиям или на случай необходимости.

Так я автоматизировал хранение логов: старые файлы будут автоматически архивироваться.

### Шаг 8. Создание статического веб-сайта на базе S3

Я создал бакет `cc-lab4-web-kXX` для хостинга статического сайта:

1.  Имя: `cc-lab4-web-kXX`
2.  Region: `eu-central-1`
3.  Object Ownership: ACLs enabled (Can be configured using ACLs)
4.  _Block all public access_: снял галочку (разрешил публичность)
5.  Нажал `Create bucket`

![img](/images/img_14.png)

После создания я настроил хостинг:

1. Перешёл в бакет → вкладка `Properties` → `Static website hosting` → `Edit` -> `Enable`.
2. Выбрал следующие параметры:

   1. _Hosting type_: `Host a static website`.
   2. _Index document_: `index.html`.

3. Проанализировал веб-сайт, прикрепленный к данной лабораторной работе.

4. Скопировал файлы веб-сайта в бакет `cc-lab4-web-kXX`. _Не забыл сделать файлы публичными!_
![img](/images/img_15.png)

5. Открыл URL статического сайта, указанный в настройках S3.
![img](/images/img_16.png)
![img](/images/img_17.png)

С помощью S3 можно быстро и просто развернуть статический сайт без необходимости использования серверов. Например, если у вас есть React-приложение, его собранные файлы можно загрузить в такой бакет для хостинга.

> Несмотря на удобство, для серьёзных проектов рекомендуется использовать специализированные сервисы хостинга (например, AWS Amplify), которые предоставляют дополнительные возможности.

## Контрольные вопросы

Контрольные вопросы указаны выше в некоторых заданиях. Ответьте на них письменно во время выполнения лабораторной работы.